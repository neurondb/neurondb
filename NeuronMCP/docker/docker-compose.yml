# NeuronMCP Docker Compose Configuration
# Standalone service that connects to external NeuronDB instance
# MCP protocol uses stdio for communication
#
# Network Configuration:
# - Option 1: Use 'default' network (localhost:5433 connection from host)
# - Option 2: Use external 'neurondb-network' (connect via container name 'neurondb-cpu:5432')
#   To enable: docker network create neurondb-network, then uncomment external network config below

services:
  neurondb-mcp:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    image: neurondb-mcp:latest
    container_name: neurondb-mcp
    environment:
      # Database connection - point to external NeuronDB instance
      # When connecting from host: use localhost:5433
      # When connecting via Docker network: use neurondb-cpu:5432 (container name:internal port)
      # Note: host.docker.internal only works on Docker Desktop (Mac/Windows), not on Linux
      NEURONDB_HOST: ${NEURONDB_HOST:-localhost}
      NEURONDB_PORT: ${NEURONDB_PORT:-5433}
      NEURONDB_DATABASE: ${NEURONDB_DATABASE:-neurondb}
      NEURONDB_USER: ${NEURONDB_USER:-neurondb}
      NEURONDB_PASSWORD: ${NEURONDB_PASSWORD:-neurondb}
      
      # Alternative: use connection string
      NEURONDB_CONNECTION_STRING: ${NEURONDB_CONNECTION_STRING:-}
      
      # Optional: path to config file (inside container)
      NEURONDB_MCP_CONFIG: ${NEURONDB_MCP_CONFIG:-/app/mcp-config.json}
      
      # Logging
      NEURONDB_LOG_LEVEL: ${NEURONDB_LOG_LEVEL:-info}
      NEURONDB_LOG_FORMAT: ${NEURONDB_LOG_FORMAT:-text}
      NEURONDB_LOG_OUTPUT: ${NEURONDB_LOG_OUTPUT:-stderr}
      
      # Feature flags
      NEURONDB_ENABLE_GPU: ${NEURONDB_ENABLE_GPU:-false}
    
    # MCP uses stdio, so we need to keep stdin open and use tty for interactive mode
    stdin_open: true
    tty: true
    
    # Keep container running
    restart: unless-stopped
    
    networks:
      - default
      # Uncomment below to use shared neurondb-network for container-to-container communication
      # - neurondb-network
    
    # Optional: mount config file for custom configuration
    # volumes:
    #   - ./mcp-config.json:/app/mcp-config.json:ro

networks:
  default:
    name: neuronmcp-network
    driver: bridge
  # Uncomment below to use external shared network (requires: docker network create neurondb-network)
  # neurondb-network:
  #   name: neurondb-network
  #   external: true

